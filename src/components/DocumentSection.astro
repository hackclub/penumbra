---
const { id } = Astro.props;
interface Props {
  id: string;
}
---

<section class="doc-section" id={id}>
  <div class="inner">
    <slot/>
  </div>
</section>

<script>
  import { animateTyping, animateObfuscation } from "../scripts/text-anim";

  for (const section of document.querySelectorAll(".doc-section > .inner")) {
    const observer = new IntersectionObserver(entries => {
      if (!entries[0].isIntersecting === true)
        return;

      for (const element of section.querySelectorAll<HTMLHeadingElement>("*:not(.no-anim) > h1:not(.no-anim)")) {
        animateTyping(element, 3, 12);
      }

      for (const element of section.querySelectorAll<HTMLParagraphElement>("*:not(.no-anim) > p:not(.no-anim)")) {
        animateObfuscation(element, 8, 0.25);
      }
    }, { threshold: [0.1] });

    observer.observe(section);
  }
</script>

<style lang="scss" is:global>
  .doc-section {
    color: white;
    font-size: 1.5em;
    padding: 2em;
    padding-top: 1em;
    padding-bottom: 0;

    $bg-transition-length: 20%;
    $bg-transition-alpha: 0.5;

    background: linear-gradient(
      0deg,
      rgba(0, 0, 0, 0.00) 0%, 
      rgba(0, 0, 0, $bg-transition-alpha) $bg-transition-length, 
      rgba(0, 0, 0, $bg-transition-alpha) 100% - $bg-transition-length, 
      rgba(0, 0, 0, 0.00) 100%
    );

    .inner {
      width: 100%;
      height: 100%;
      // border: 2px solid white;
      // background: rgba(#000, 0.5);
      // backdrop-filter: blur(8px);
      padding: 2em;

      @media screen and (max-width: 800px) {
        padding: 1em;
      }

      @media screen and (max-width: 400px) {
        padding: .5em;
      }
    }

    em {
      color: #FFC800;
    }

    h1 {
      font-size: 2em;
      margin: 0;

      &::before {
        content: ">>> ";
      }
    }

    h1, h2, h3, p, details > summary, .glow {
      filter: drop-shadow(0 0 2px #fff);
    }

    a {
      text-decoration: none;
    }

    a.btn {
      display: block;
      width: fit-content;
      color: #000;
      background-color: #fff;
      padding: .5em 2em;
    }
  }
</style>
